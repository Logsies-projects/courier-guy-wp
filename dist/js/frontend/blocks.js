(()=>{"use strict";var e={20:(e,t,c)=>{var n=c(609),o=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function r(e,t,c){var n,r={},d=null,l=null;for(n in void 0!==c&&(d=""+c),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,n)&&!s.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:o,type:e,key:d,ref:l,props:r,_owner:i.current}}t.jsx=r,t.jsxs=r},609:e=>{e.exports=window.React},848:(e,t,c)=>{e.exports=c(20)}},t={};const c=window.wp.i18n,n=window.wp.element;var o=function c(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,c),a.exports}(848);let a={isValid:!0,message:""};const i=e=>{a=e?{isValid:!1,message:"Calculating totals, please wait..."}:{isValid:!0,message:""},document.querySelectorAll(".wc-block-components-shipping-rates-control input, .wc-block-components-shipping-rates-control button").forEach(t=>{t.disabled=e}),document.querySelectorAll(".wc-block-components-payment-methods input, .wc-block-components-payment-methods button").forEach(t=>{t.disabled=e}),document.querySelectorAll('.wc-block-components-checkout-place-order-button, button[name="place_order"]').forEach(t=>{t.disabled=e}),document.querySelectorAll(".tcg-option-checkbox").forEach(t=>{t.disabled=e});let t=document.getElementById("tcg-checkout-message");if(!t){t=document.createElement("div"),t.id="tcg-checkout-message",t.style.color="red",t.style.margin="10px 0";const e=document.getElementById("tcg-checkout-container");e&&e.prepend(t)}t.textContent=a.message,t.style.display=e?"block":"none"},s=()=>{if(window.wp&&window.wp.data&&window.wp.data.dispatch)try{const{dispatch:e,select:t}=window.wp.data;e("wc/store/cart")&&e("wc/store/cart").invalidateResolutionForStore(),e("wc/store/checkout")&&e("wc/store/checkout").invalidateResolutionForStore(),e("wc/store/shipping")&&e("wc/store/shipping").invalidateResolutionForStore(),e("wc/store/cart").receiveCart&&setTimeout(()=>{t("wc/store/cart").getCartData&&e("wc/store/cart").receiveCart(t("wc/store/cart").getCartData())},200)}catch(e){}const e=document.querySelectorAll('input[name*="shipping"], select[name*="shipping"]');if(e.length>0){const t=new Event("change",{bubbles:!0});e[0].dispatchEvent(t)}"undefined"!=typeof jQuery&&(jQuery(document.body).trigger("update_checkout"),jQuery(document.body).trigger("wc_update_cart"),jQuery(document.body).trigger("updated_checkout"));const t=new CustomEvent("tcg_shipping_options_updated",{detail:{action:"recalculate_shipping",timestamp:Date.now()},bubbles:!0});document.dispatchEvent(t),setTimeout(()=>{const e=document.querySelector("form.wc-block-checkout__form");if(e){const t=new Event("input",{bubbles:!0}),c=e.querySelector("input, select");c&&c.dispatchEvent(t)}},100)},r=()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!0),[d,l]=(0,n.useState)([]),[p,u]=(0,n.useState)([]),[h,m]=(0,n.useState)(!1),[g,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=setTimeout(()=>{y(),f()},1e3);return()=>clearTimeout(e)},[]);const y=async()=>{try{r(!0);const e=await fetch(tcg_data.api_url+"shipping-options",{method:"GET",headers:{"X-WP-Nonce":tcg_data.nonce,"Content-Type":"application/json"}});if(e.ok){const c=await e.json();if(Array.isArray(c)&&c.length>0){t(c);const e=c.filter(e=>"regular"===e.type&&e.checked).map(e=>e.id),n=c.filter(e=>"time_based"===e.type&&e.checked).map(e=>e.id);l(e),u(n)}else t([]),l([]),u([])}else t([])}catch(e){}finally{r(!1)}},f=async()=>{try{const e=await fetch(tcg_data.api_url+"insurance",{method:"GET",headers:{"X-WP-Nonce":tcg_data.nonce,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();m(t.enabled),_(t.checked)}}catch(e){}},w=async(e,t)=>{const c=document.querySelector("form.wc-block-checkout__form")||document.body;c.querySelectorAll('input[name="tcg_ship_logic_optins[]"], input[name="tcg_ship_logic_time_based_optins[]"]').forEach(e=>e.remove()),e.forEach(e=>{const t=document.createElement("input");t.type="hidden",t.name="tcg_ship_logic_optins[]",t.value=e,c.appendChild(t)}),t.forEach(e=>{const t=document.createElement("input");t.type="hidden",t.name="tcg_ship_logic_time_based_optins[]",t.value=e,c.appendChild(t)});try{try{const c=await fetch(tcg_data.api_url+"update-shipping-options",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tcg_ship_logic_optins:e,tcg_ship_logic_time_based_optins:t})});if(c.ok&&(await c.json()).success)return void s()}catch(e){}const c=new FormData;c.append("action","tcg_update_shipping_options"),c.append("nonce",tcg_data.nonce),e.forEach(e=>c.append("tcg_ship_logic_optins[]",e)),t.forEach(e=>c.append("tcg_ship_logic_time_based_optins[]",e)),(await fetch(tcg_data.ajax_url||"/wp-admin/admin-ajax.php",{method:"POST",body:c})).ok&&s()}catch(e){}};return a?(0,o.jsxs)("div",{className:"tcg-checkout-block",children:[(0,o.jsx)("h3",{className:"tcg-checkout-title wc-block-components-title",children:(0,c.__)("TCG Shipping Options","the-courier-guy")}),(0,o.jsx)("div",{className:"tcg-checkout-content",children:(0,o.jsx)("p",{children:(0,c.__)("Loading shipping options...","the-courier-guy")})})]}):e.length?(0,o.jsxs)("div",{className:"tcg-checkout-block",children:[(0,o.jsx)("h3",{className:"tcg-checkout-title wc-block-components-title",children:(0,c.__)("TCG Shipping Options","the-courier-guy")}),(0,o.jsx)("div",{className:"tcg-checkout-content",children:(0,o.jsx)("ul",{className:"tcg-shipping-options-list",children:e.map(e=>{const t="regular"===e.type?d.includes(e.id):p.includes(e.id);return(0,o.jsx)("li",{className:"tcg-shipping-option update_totals_on_change",children:(0,o.jsxs)("label",{className:"tcg-option-label",children:[(0,o.jsx)("input",{type:"checkbox",value:e.id,checked:t,onChange:t=>{return c=e.id,n=e.type,o=t.target.checked,i(!0),void("regular"===n?l(e=>{const t=o?[...e,c]:e.filter(e=>e!==c);return w(t,p).finally(()=>i(!1)),t}):"time_based"===n&&u(e=>{const t=o?[...e,c]:e.filter(e=>e!==c);return w(d,t).finally(()=>i(!1)),t}));var c,n,o},className:"tcg-option-checkbox"}),(0,o.jsx)("span",{className:"tcg-option-name",children:e.name}),(0,o.jsx)("span",{className:"tcg-option-price",dangerouslySetInnerHTML:{__html:e.price_formatted}})]})},e.id)})})})]}):null},d=()=>{const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=()=>{d()};return document.addEventListener("tcg_shipping_options_updated",e),document.addEventListener("updated_checkout",e),d(),()=>{document.removeEventListener("tcg_shipping_options_updated",e),document.removeEventListener("updated_checkout",e)}},[]);const d=async()=>{console.log("Fetching insurance status...");try{const e=await fetch(tcg_data.api_url+"insurance",{method:"GET",headers:{"X-WP-Nonce":tcg_data.nonce,"Content-Type":"application/json"}});if(e.ok){const c=await e.json();t(c.enabled),r(c.checked)}}catch(e){}};if(e)return(0,o.jsx)("div",{className:"tcg-insurance-block",style:{margin:"1.5em 0",padding:"1em 0",borderTop:"1px solid #eee"},children:(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"tcg_billing_insurance",checked:a,onChange:e=>{const t=e.target.checked;r(t),(async e=>{r(e),i(!0);try{await fetch(tcg_data.api_url+"insurance",{method:"POST",headers:{"X-WP-Nonce":tcg_data.nonce,"Content-Type":"application/json"},body:JSON.stringify({checked:e})}),s()}finally{i(!1)}})(t),t&&console.log("insurance checked")}})," ",(0,c.__)("Would you like to include Shipping Insurance?","the-courier-guy")]})})},l=()=>{const e=document.querySelector(".wc-block-components-shipping-rates-control");if(!e)return;let t=document.getElementById("tcg-checkout-container");t||(t=document.createElement("div"),t.id="tcg-checkout-container",e.insertAdjacentElement("afterend",t)),wp.element.render((0,o.jsx)(r,{}),t);let c=document.getElementById("tcg-insurance-container");c||(c=document.createElement("div"),c.id="tcg-insurance-container",t.insertAdjacentElement("afterend",c)),wp.element.render((0,o.jsx)(d,{}),c),document.querySelectorAll('.wc-block-components-shipping-rates-control input[type="radio"]').forEach(e=>{e.addEventListener("change",()=>{i(!0),setTimeout(()=>{i(!1)},1500)})})};new MutationObserver(()=>{!document.getElementById("tcg-checkout-container")&&document.querySelector(".wc-block-components-shipping-rates-control")&&l(),!document.getElementById("tcg-insurance-container")&&document.getElementById("tcg-checkout-container")&&l()}).observe(document.body,{childList:!0,subtree:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})();